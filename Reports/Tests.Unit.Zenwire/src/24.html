<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>c:\projects\zenwire\zenwire\repositories\repository.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Data;
using System.Data.Entity;
using System.Data.Objects;
using System.Data.Objects.DataClasses;
using System.Diagnostics.CodeAnalysis;
using System.Linq;
using System.Linq.Expressions;
using Zenwire.Extensions;

namespace Zenwire.Repositories
{
    [ExcludeFromCodeCoverage]
    public class Repository&lt;T&gt; : IRepository&lt;T&gt; where T : class
    {
        readonly ZenwireContext _context;

        public Repository(ZenwireContext context) 
        {
            _context = context;
        }
 
        public IQueryable&lt;T&gt; Get
        {
            get { return _context.Set&lt;T&gt;(); }
        }
 
        public IQueryable&lt;T&gt; GetIncluding(params Expression&lt;Func&lt;T, object&gt;&gt;[] includeProperties)
        {
            IQueryable&lt;T&gt; query = _context.Set&lt;T&gt;();
            return includeProperties.Aggregate(query, (current, includeProperty) =&gt; current.Include(includeProperty));
        }
 
        public T Find(object[] keyValues)
        {
            return _context.Set&lt;T&gt;().Find(keyValues);
        }

        public T Find(int id)
        {
            return _context.Set&lt;T&gt;().Find(id);
        }


        public void Add(T entity)
        {
            _context.Set&lt;T&gt;().Add(entity);
            _context.SaveChanges();
            _context.Entry(entity).GetDatabaseValues();

            //return entity.ID;
        }

        
        public T FindBy(T entity)
        {
            return _context.Set&lt;T&gt;().Find(entity);
        }
 
        public void Update(T entity)
        {
            var entry = _context.Entry(entity);
            if (entry.State == EntityState.Detached)
            {
                _context.Set&lt;T&gt;().Attach(entity);
                entry = _context.Entry(entity);
            }
            entry.State = EntityState.Modified;
            _context.SaveChanges();
        }
 
        public void AddOrUpdate(T entity)
        {
            //uses DbContextExtensions to check value of primary key
            _context.AddOrUpdate(entity);
            _context.SaveChanges();
        }

        public void Remove(object[] keyValues)
        {
            //uses DbContextExtensions to attach a stub (or the actual entity if loaded)
            var stub = _context.Load&lt;T&gt;(keyValues);
            _context.Set&lt;T&gt;().Remove(stub);
            _context.SaveChanges();
        }

        public void Remove(T entity)
        {
            _context.Set&lt;T&gt;().Remove(entity);
            _context.SaveChanges();
        }

        public void Dispose(bool disposing)
        {

        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[18,9,18,50,0],[19,9,19,10,0],[20,13,20,32,0],[21,9,21,10,0],[25,17,25,18,0],[25,19,25,44,0],[25,45,25,46,0],[29,9,29,10,0],[30,13,30,53,0],[31,13,31,85,0],[31,117,31,119,0],[32,9,32,10,0],[35,9,35,10,0],[36,13,36,54,0],[37,9,37,10,0],[40,9,40,10,0],[41,13,41,47,0],[42,9,42,10,0],[46,9,46,10,0],[47,13,47,43,0],[48,13,48,36,0],[49,13,49,56,0],[52,9,52,10,0],[56,9,56,10,0],[57,13,57,51,0],[58,9,58,10,0],[61,9,61,10,0],[62,13,62,48,0],[63,13,63,53,0],[64,13,64,14,0],[65,17,65,50,0],[66,17,66,48,0],[67,13,67,14,0],[68,13,68,48,0],[69,13,69,36,0],[70,9,70,10,0],[73,9,73,10,0],[75,13,75,42,0],[76,13,76,36,0],[77,9,77,10,0],[80,9,80,10,0],[82,13,82,52,0],[83,13,83,44,0],[84,13,84,36,0],[85,9,85,10,0],[88,9,88,10,0],[89,13,89,46,0],[90,13,90,36,0],[91,9,91,10,0],[94,9,94,10,0],[96,9,96,10,0],[31,85,31,117,0]]);
    </script>
  </body>
</html>